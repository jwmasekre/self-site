<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>josh&#39;s posh #2 - an admin console for everyone :: /home/</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Today&#39;s post is covering one of the first things I made at my previous employer, which I also have a sanitized version on my github here. We used smartcards for login, and we had separate cards and accounts for administration. We also couldn&#39;t select a separate account through UAC for installers/administrative applications, so the solution was to open command prompt and run runas /smartcard cmd.exe, select the admin card, and have a command prompt open as our admin account."/>
<meta name="keywords" content=", "/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="/posts/joshs_posh_2_adminconsole/" />


<link rel="stylesheet" href="/assets/style.css">

  <link rel="stylesheet" href="/assets/blue.css">






<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">

<link rel="shortcut icon" href="/img/favicon/blue.png">



<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="josh&#39;s posh #2 - an admin console for everyone :: /home/ — " />
<meta name="twitter:description" content="Today&#39;s post is covering one of the first things I made at my previous employer, which I also have a sanitized version on my github here. We used smartcards for login, and we had separate cards and accounts for administration. We also couldn&#39;t select a separate account through UAC for installers/administrative applications, so the solution was to open command prompt and run runas /smartcard cmd.exe, select the admin card, and have a command prompt open as our admin account." />
<meta name="twitter:site" content="/" />
<meta name="twitter:creator" content="josh masek" />
<meta name="twitter:image" content="/img/Powershell_av_colors.ico">


<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="josh&#39;s posh #2 - an admin console for everyone :: /home/ — ">
<meta property="og:description" content="Today&#39;s post is covering one of the first things I made at my previous employer, which I also have a sanitized version on my github here. We used smartcards for login, and we had separate cards and accounts for administration. We also couldn&#39;t select a separate account through UAC for installers/administrative applications, so the solution was to open command prompt and run runas /smartcard cmd.exe, select the admin card, and have a command prompt open as our admin account." />
<meta property="og:url" content="/posts/joshs_posh_2_adminconsole/" />
<meta property="og:site_name" content="josh&#39;s posh #2 - an admin console for everyone" />
<meta property="og:image" content="/img/Powershell_av_colors.ico">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2019-12-16 00:00:00 &#43;0000 UTC" />











</head>
<body class="">


<div class="container">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    joshuamasek.com
  </div>
</a>

    </div>
    <div class="menu-trigger">menu</div>
  </div>
  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">about</a></li>
        
      
        
          <li><a href="https://github.com/jwmasekre">showcase</a></li>
        
      
      
    

    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">about</a></li>
      
    
      
        <li><a href="https://github.com/jwmasekre">showcase</a></li>
      
    
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<div class="post">
  <h1 class="post-title">
    <a href="/posts/joshs_posh_2_adminconsole/">josh's posh #2 - an admin console for everyone</a></h1>
  <div class="post-meta">
      
    <span class="post-date">
      2019-12-16
    </span>
    
    
    <span class="post-author">::
      josh masek
    </span>
    
  </div>

  
  <span class="post-tags">
    
    #<a href="/tags/posh/">posh</a>&nbsp;
    
    #<a href="/tags/powershell/">powershell</a>&nbsp;
    
    #<a href="/tags/.net/">.net</a>&nbsp;
    
    #<a href="/tags/forms/">forms</a>&nbsp;
    
    #<a href="/tags/gui/">gui</a>&nbsp;
    
  </span>
  

  
  <img src="/img/Powershell_av_colors.ico" class="post-cover" />
  

  <div class="post-content">
    <p>Today's post is covering one of the first things I made at my previous employer, which I also have a sanitized version <a href="https://github.com/jwmasekre/RandomPoshScripts/tree/master/Scripts/admingui">on my github here</a>. We used smartcards for login, and we had separate cards and accounts for administration. We also couldn't select a separate account through UAC for installers/administrative applications, so the solution was to open command prompt and run <code>runas /smartcard cmd.exe</code>, select the admin card, and have a command prompt open as our admin account. From there, we could run any of the various tools we had installed, but this felt too manual to me, so I began investigating automation.</p>
<p>My admin tool launcher went through a couple iterations, starting as just a batch script to launch all of my tools as my admin account, but eventually I discovered <a href="https://poshgui.com/">POSHGUI</a>, which I leveraged to build the base infrastructure for my admin tool.</p>
<p>The <code>contents.txt</code> file in my repo describes all of the files that make this work. I built this with easy of deployment in mind, and leveraged Windows&rsquo; shortcuts to set taskbar icons. The <code>adminguilauncher.bat</code> launches <code>iconlaunch.bat</code> using <code>runas /smartcard</code>. <code>iconlaunch.bat</code> links to the <code>powershell.lnk</code> shortcut, which links to powershell, but with the <code>adminguiico2-2.ico</code> icon set, so it uses that icon on the taskbar. That batch script launches the actual <code>admingui.ps1</code> script that builds the form.</p>
<p>The script starts with the functions. I have a function for each button, and the majority are <code>start-process &lt;command or path to binary&gt; -verb runas</code>, which launches that command in an administrative context. The only exception is SCCM, which I had testing two different known install locations for the management console instead of checking the registry (something I learned to do much later).</p>
<p>Then we get to the form itself, which uses .Net to build a Windows Form. First, we add <code>system.Windows.Forms</code> and <code>System.drawing</code>, which we will be using to build the tool. Second, we create the window itself using <code>$AdminConsole = New-Object Windows.Forms.Form</code> and design it with <code>$AdminConsole</code>'s properties. We can then add more stuff to add to the form. I created an instruction label using <code>$instructions = New-Object system.Windows.Forms.Label</code> and set its <code>.parent</code> to <code>$AdminConsole</code>. The buttons are created using <code>New-Object Windows.Forms.Buttion</code> and the locations of everything is set by setting the <code>location</code> property of each object equal to `New-Object System.Drawing.Point(&lt;x&gt;,&lt;y&gt;).</p>
<p>Once we've created all of our objects, we then have to add them to a collection via <code>$adminConsole.controls.AddRange(@($firstobject,..$lastobject))</code> and then start assigning actions to each of the objects. For example, I have a button named <code>$cmd</code>, and to assign it the function <code>run-cmd</code> I put <code>$cmd.Add_Click({run-cmd})</code>. Once we have finished assigning everything, we end it with <code>[void]$AdminConsole.ShowDialog()</code> and we have a window filled with buttons that we can use to launch a bunch of tools as admin! If we create a desktop shortcut to the <code>adminguilauncher.bat</code> file, anyone can just double-click that link and the process begins. No more memorizing commands or looking up file locations.</p>
<p>I plan on returning to this to improve upon the whole thing; I know I can cut out a ton of redundant lines of code, and I've been playing with the idea of making it significantly more modular than it currently is. I know I can come up with a system of automating the functions and the buttons, and I'll probably upload a 2.0 version and a follow-up post when I finish that.</p>

  </div>
  
  <div class="pagination">
    <div class="pagination__title">
      <span
        class="pagination__title-h">read other posts</span>
      <hr />
    </div>
    <div class="pagination__buttons">
      
      
      <span class="button next">
        <a href="/posts/kringlecon2019/">
          <span class="button__text">come ctf with me #1 - kringlecon 2019</span>
          <span class="button__icon">→</span>
        </a>
      </span>
      
    </div>
  </div>
  

  

</div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2019 Powered by <a href="http://gohugo.io">Hugo</a></span>
    
        <span>:: Theme made by <a href="https://twitter.com/panr">panr</a></span>
      </div>
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>





  
</div>

</body>
</html>
